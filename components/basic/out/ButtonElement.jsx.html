<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ButtonElement.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ButtonElement.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react";
import TodoStore from '../_event/TodoStore.js';


/**
 *
 *
 * the constructor above  is generated by jsDock,u should use &amp;lt;ButtonElement/ &amp;gt; instead
 * @author danding001
 * @constructor ButtonElement
 * @example
 *
 * &lt;ButtonElement cb={this.cb} />;
 *
 * @see {@link http://www.w3school.com.cn/json/|u can learn more about JSONObject if u click this}
 */

var ButtonElement=React.createClass({
            feedbackCb:function(ob)
            {

                this.state.feedback.params[ob.id]=ob.content;
                var count=0;
                for(var item in this.state.feedback.params)
                {
                    count++;
                }
                if(this.state.broadcastCount==count)
                {
                    var feedback;
                    this.queryHandle(this.state.feedback.params);
                    this.state.feedback.params=new Array();
                }
            },
            clickCb:function(evt){
                if(this.state.publish!==undefined&amp;&amp;this.state.publish!==null)//优先处理订阅事件
                {
                    if(this.state.publish.type==undefined||this.state.publish.type==null)
                        throw "publish type undefined!";
                    TodoStore.emit(this.state.publish.type);
                }else{
                    if(this.props.query!==undefined&amp;&amp;this.props.query!==null)
                    {
                        if(this.props.query.params!==undefined&amp;&amp;this.props.query.params!==undefined)
                           this.queryHandle();
                    }
                    else{
                        if(this.props.handle!==undefined&amp;&amp;this.props.handle!==null)
                            this.props.handle(evt);
                    }
                }
            },
            queryHandle:function(ob){
                var query=this.props.query;
                if(ob!==undefined&amp;&amp;ob!==null)
                    Object.assign(query.params,ob);
                console.log();
                $.ajax({
                    type: 'POST',
                    url: query.url,
                    dataType: 'json',
                    data: query.params,
                    cache: false,
                    success: function(data) {
                        if(this.props.handle!==null&amp;&amp;this.props.handle!==undefined)
                            this.props.handle(data);
                    }.bind(this),
                    error: function(xhr, status, err) {
                        console.error(this.props.url, status, err.toString());
                    }
                });
            },
    /**
     * @private
     * @function getInitialState
     * @description 组件第一次渲染时调用
     * @param {Object} subscribe - {type:{eventName},callback:[]} 订阅信息存储
     * @param {Object} publish -  {type:{eventName},callback:[]} 发布信息存储
     * @returns {Object} 组件的初始状态，外部组件无法直接访问
     */
    getInitialState:function(){
                var subscribe;
                if(this.props.subscribe!==undefined&amp;&amp;this.props.subscribe!==null)
                subscribe=this.props.subscribe;

                var broadcastCount;
                var feedback;
                var publish;
                if(this.props.publish!==undefined&amp;&amp;this.props.publish!==null) {
                    publish=this.props.publish;
                    broadcastCount=this.props.publish.broadcastCount;
                    feedback={}
                    feedback["count"]=0;
                    feedback["params"]={};
                }

                return  {subscribe:subscribe,publish:publish,broadcastCount:broadcastCount,feedback:feedback};
            },
            render:function(){
                var marginStyle={
                    marginRight:"20px"
                };


                var buttonClass;
                if(this.props.buttonClass!==undefined&amp;&amp;this.props.buttonClass!==null)
                buttonClass=this.props.buttonClass;
                var title;
                if(this.props.title!==null&amp;&amp;this.props.title!==undefined)
                    title=this.props.title;
                var data_toggle;
                if(this.props["data-toggle"]!==null&amp;&amp;this.props["data-toggle"]!==undefined)
                data_toggle=this.props["data-toggle"];
                var arial_hasPopup;
                if(this.props["aria-haspopup"]!==null&amp;&amp;this.props["aria-haspopup"]!==undefined)
                arial_hasPopup=this.props["aria-haspopup"];
                var  aria_expanded;
                if(this.props["aria-expanded"]!==null&amp;&amp;this.props["aria-expanded"]!==undefined)
                    aria_expanded=this.props["aria-expanded"];
                return(
                    &lt;button type={this.props.type} className={buttonClass} onClick={this.clickCb}
                        style={marginStyle} data-toggle={data_toggle} aria-expanded={aria_expanded}>
                        {title}
                        {this.props.children}
                        &lt;/button>
                )
            },
            componentDidMount:function(){
                //注册订阅
                if(this.state.subscribe!==undefined&amp;&amp;this.state.subscribe!==null)
                {
                    var subscribe=this.state.subscribe;
                    var instance=this;
                    subscribe.map(function(item,i) {
                        if(item['type']!==undefined&amp;&amp;item['type']!==null) {
                            TodoStore.addChangeListener(item['type'],item['callback'].bind(instance));
                        }
                    });
                }
                //注册消息发布
                if(this.state.publish!==undefined&amp;&amp;this.state.publish!==null&amp;&amp;
                this.state.broadcastCount!==undefined&amp;&amp;this.state.broadcastCount!==null) {
                    var publish=this.state.publish;
                    TodoStore.addChangeListener(publish.feedback.type,this.feedbackCb);
                }
            },
            componentWillUnmount:function()
            {
                //销毁订阅
                if(this.state.subscribe!==undefined&amp;&amp;this.state.subscribe!==null) {
                    var subscribe=this.state.subscribe;
                    subscribe.map(function(item,i) {
                        if(item['type']!==undefined&amp;&amp;item['type']!==null) {
                            TodoStore.removeChangeListener(item['type'],item['callback']);
                        }
                    });
                }
                //销毁消息发布
                if(this.state.publish!==undefined&amp;&amp;this.state.publish!==null) {
                    TodoStore.removeChangeListener('feedback',this.feedbackCb);
                }
            }
});

export default ButtonElement;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ButtonElement.html">ButtonElement</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getInitialState">getInitialState</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat Mar 12 2016 17:20:12 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
